# Grafana Observability Stack Backup Configuration
# Configuration for backing up Grafana dashboards, configs, and SQLite database
# Edit this file to customize backup behavior

# Backup destination directory
# For external drive, change this to: /Volumes/YOUR_DRIVE_NAME/GrafanaBackups
# For NAS, change this to: /mnt/nas/GrafanaBackups
BACKUP_BASE_DIR="${HOME}/GrafanaBackups"

# Retention policy
RETENTION_DAILY=7      # Keep daily SQLite snapshots for 7 days
RETENTION_WEEKLY=4     # Keep weekly SQLite snapshots (Sunday) for 4 weeks
RETENTION_EXPORTS=30   # Keep API exports for 30 days

# Docker configuration
COMPOSE_PROJECT="grafana-orbstack"
COMPOSE_FILE="docker-compose.grafana.yml"
GRAFANA_CONTAINER="grafana-main"

# Grafana API Configuration
# For security, API key should be set in ~/.env file:
#   GRAFANA_API_KEY="your-service-account-token"
# Create a service account token in Grafana UI:
#   Configuration > Service accounts > Add service account > Generate token
GRAFANA_HOST="${GRAFANA_HOST:-http://localhost:3001}"
GRAFANA_USER="${GRAFANA_USER:-admin}"
GRAFANA_PASSWORD="${GRAFANA_PASSWORD:-admin}"

# OrbStack volume paths
ORBSTACK_VOLUMES="${HOME}/OrbStack/docker/volumes"
GRAFANA_VOLUME="${COMPOSE_PROJECT}_grafana-storage"

# Backup components (set to true/false to enable/disable)
BACKUP_SQLITE=true           # SQLite database snapshots
BACKUP_DASHBOARDS=true       # Export dashboards via API
BACKUP_ALERTS=true           # Export alert rules via API
BACKUP_DATASOURCES=true      # Export datasource configs via API
BACKUP_NOTIFICATIONS=true    # Export notification policies via API

# Notification settings (optional)
# NOTIFY_EMAIL=""
# NOTIFY_ON_SUCCESS=false
# NOTIFY_ON_FAILURE=true

# External drive detection (optional)
# If set, backup will only run if this volume is mounted
# REQUIRED_VOLUME="/Volumes/GrafanaBackup"

# Compression level (1-9, higher = better compression but slower)
COMPRESSION_LEVEL=6

# Log retention (days)
LOG_RETENTION=30

# Monitoring metrics export
# Export backup metrics to Grafana Alloy for observability
METRICS_ENABLED=true
METRICS_PORT=9099           # Port for metrics exporter
ALLOY_OTLP_HTTP="http://localhost:4318"  # Alloy OTLP HTTP endpoint

# Validation settings
VALIDATE_JSON=true          # Validate exported JSON files
VALIDATE_SQLITE=true        # Check SQLite database integrity
VALIDATE_GIT=true           # Check git repository status

# Backup triggers
# These determine when automatic backups are triggered
TRIGGER_ON_COMMIT=true      # Backup after git commits
TRIGGER_ON_PUSH=true        # Validate before git push
TRIGGER_ON_MERGE=true       # Sync after git merge
TRIGGER_DAILY_HOUR=2        # Hour for daily backups (24-hour format)