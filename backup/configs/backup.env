# Grafana Observability Stack - Backup Configuration
# Main configuration for offen/docker-volume-backup services
# This file is sourced by docker-compose.backup.yml

# Storage Configuration
# Primary backup location (hot tier - local SSD)
BACKUP_DIR=${HOME}/GrafanaBackups

# External drive configuration (warm tier - when mounted)
EXTERNAL_DRIVE=SanDisk
# Alternative external drives (uncomment as needed)
# EXTERNAL_DRIVE=WD_Backup
# EXTERNAL_DRIVE=NAS_Mount

# Retention Policies
# Critical data (Grafana + Prometheus)
RETENTION_CRITICAL=30      # Days to keep daily backups
RETENTION_CRITICAL_WEEKLY=12  # Weeks to keep weekly snapshots

# Bulk data (Tempo + Loki)
RETENTION_BULK=14          # Days to keep bulk backups
RETENTION_BULK_MONTHLY=3   # Months to keep monthly archives

# Metrics export
RETENTION_METRICS=7        # Days to keep metrics exports

# Performance Tuning
GZIP_PARALLELISM=4        # Parallel compression threads (0 = all cores)
BACKUP_BUFFER_SIZE=64M    # I/O buffer size for large files

# Notification Configuration
# Leave empty to disable notifications
# NOTIFICATION_URLS=smtp://user:pass@smtp.gmail.com:587/?from=backup@example.com&to=admin@example.com
# Slack example:
# NOTIFICATION_URLS=slack://xoxb-token@workspace#channel
# Multiple destinations (comma-separated):
# NOTIFICATION_URLS=smtp://...,slack://...

NOTIFICATION_URLS=
NOTIFICATION_LEVEL=error  # Options: error (failures only), info (all backups)

# Backup Windows
# Stagger backup times to avoid I/O contention
CRITICAL_BACKUP_HOUR=2    # 2 AM for critical data
BULK_BACKUP_HOUR=3        # 3 AM for bulk data
METRICS_EXPORT_HOUR=1     # 1 AM for metrics export

# Container Management
STOP_TIMEOUT=5m           # Max time to wait for container stop
GRACE_PERIOD=30s          # Grace period before force stop

# Validation Settings
VALIDATE_ARCHIVES=true    # Test archive integrity after backup
VALIDATE_THRESHOLD=95     # Alert if backup success rate < 95%

# External Storage Sync
RSYNC_BANDWIDTH_LIMIT=    # Limit in KB/s (empty = unlimited)
RSYNC_DELETE=true         # Delete files from external that don't exist locally
RSYNC_CHECKSUM=false      # Use checksums instead of mod-time (slower but accurate)

# S3/Cloud Storage (Optional - uncomment to enable)
# AWS_S3_BUCKET_NAME=grafana-backups
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
# AWS_S3_PATH=observability/
# AWS_STORAGE_CLASS=GLACIER_IR  # For long-term archives

# MinIO Configuration (Optional - for self-hosted S3)
# AWS_ENDPOINT=minio.local:9000
# AWS_S3_BUCKET_NAME=backups
# AWS_ACCESS_KEY_ID=minioadmin
# AWS_SECRET_ACCESS_KEY=minioadmin

# Encryption (Optional - uncomment to enable)
# GPG_PASSPHRASE=your-secure-passphrase
# Or for asymmetric encryption:
# GPG_PUBLIC_KEY_RING=$(cat ~/.gnupg/backup-pubkey.asc)

# Advanced Options
BACKUP_SKIP_BACKENDS_FROM_PRUNE=  # Comma-separated: s3,webdav,local
BACKUP_EXCLUDE_REGEXP=\.log$|\.tmp$  # Exclude temporary files from backup

# Monitoring Integration
# Send backup metrics to Alloy OTLP endpoint
METRICS_ENABLED=true
ALLOY_OTLP_HTTP=http://alloy.local:4318
METRICS_JOB_NAME=backup-system

# Debug Settings (set to true for troubleshooting)
DEBUG_MODE=false
VERBOSE_OUTPUT=false
DRY_RUN=false  # Test backup without actually creating archives